<template>
    <div class="wrapper_starsign">
        <div class="galaxys__top galaxys">
            <div class="starsign_title">
                <div class="starsign_title-c">
                    <img src="images/store/uv_icone.png" alt="" />
                    <h1>星座探索</h1>
                    <img src="images/store/uv_icone.png" alt="" />
                </div>
                <div class="starsign_title-e">
                    <p>— Explore Star Sign —</p>
                </div>
            </div>
        </div>
        <div class="galaxys">
            <img class="starship" src="images/starsign/ss_bg2.png" alt="">
            <router-link class="galx1" :to="{ name: 'Starsign', query: { id: 10 }}"><img src="images/starsign/galx1.png" alt="" ></router-link>
            <router-link class="galx2" :to="{ name: 'Starsign', query: { id: 1 }}"><img src="images/starsign/galx2.png" alt="" ></router-link>
            <router-link class="galx3" :to="{ name: 'Starsign', query: { id: 4 }}"><img src="images/starsign/galx3.png" alt="" ></router-link>
            <router-link class="galx4" :to="{ name: 'Starsign', query: { id: 7 }}"><img src="images/starsign/galx4.png" alt="" ></router-link>
        </div> 

        <section class="starsignsec">
            <div class="starsignswitch">
                <router-link class="prbtn" :to="{ name: 'Starsign', query: { id: prev }}"><img src="images/starsign/prbtn.png" alt=""></router-link>
                <div class="drivingcard">
                    <h2>{{ starsignname }}</h2>
                    <div class="cardtop">
                        <img class="cardpt" :src="starsignpt" alt="" />
                        <div class="cardct">
                            <h3 class="ssbday">
                                生日 <span>{{ starsignbday1 }}</span
                                ><span> ～ </span
                                ><span>{{ starsignbday2 }}</span>
                            </h3>
                            <p class="ssprof">{{ starsignpers }}</p>
                        </div>
                    </div>
                    <div class="cardbottom">
                        <h3 class="cdbtl">MYS-2021<br />星際駕駛證</h3>
                        <div class="cdbtr">
                            <div class="prs prs1">
                                <h3>{{ pers1 }}</h3>
                                <h3>{{ pers1val }}</h3>
                            </div>
                            <div class="prs prs2">
                                <h3>{{ pers2 }}</h3>
                                <h3>{{ pers2val }}</h3>
                            </div>
                            <div class="prs prs3">
                                <h3>{{ pers3 }}</h3>
                                <h3>{{ pers3val }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <router-link class="nxbtn" :to="{ name: 'Starsign', query: { id: next }}"><img src="images/starsign/nxbtn.png" alt=""></router-link>
            </div>
            <div class="starsigncont">
                <div class="starsignleft">
                    <div class="luckyeveryday">
                        <h2>每日運勢</h2>
                        <p>{{ starsigndaily }}</p>
                    </div>
                    <div class="productforyou">
                        <h2>開運商品</h2>
                        <router-link
                            :to="{
                                name: 'ProductDetail',
                                query: { id: sspdid },
                            }"
                        >
                            <div class="sspd">
                                <img :src="sspdimg" alt="" />
                            </div>
                        </router-link>
                        <router-link
                            :to="{
                                name: 'ProductDetail',
                                query: { id: sspdid },
                            }"
                        >
                            <h3>{{ sspdtitle }}</h3>
                        </router-link>
                    </div>
                </div>
                <div class="starsignarticle">
                    <h2>相關文章</h2>
                    <div class="artiwrapper">
                        <ul class="artimenu" v-if="starart">
                            <li
                                class="artitem"
                                v-for="(arti, key) in starart"
                                :key="key"
                            >
                                <a
                                    v-if="arti.ARTICLE_TITLE"
                                    class="artitle"
                                    @click="onArtiPopOpen(arti)"
                                    >{{ arti.ARTICLE_TITLE }}</a
                                >
                                <p class="artminp" v-if="arti.ARTICLE_CONTENT">
                                    <span>{{
                                        arti.ARTICLE_CONTENT | ellipsis
                                    }}</span>
                                </p>
                                <a
                                    class="armorebtn"
                                    @click="onArtiPopOpen(arti)"
                                    >more</a
                                >
                            </li>
                        </ul>
                    </div>
                    <!-- <ul class="ssarti_pagination">
                        <li><a href="#">&lt;</a></li>
                        <li><a href="#" class="-on">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">&gt;</a></li>
                    </ul> -->
                </div>
            </div>
        </section>

        <!-- article popup -->
        <div class="overlayarticle" v-if="artipop">
            <div class="artiflex">
                <div class="articlepop">
                    <a class="articlosebtn" @click="onArtiPopClose"
                        >&times;</a
                    >

                    <h2>{{ artipop.ARTICLE_TITLE }}</h2>

                    <img :src="artipop.ARTICLE_IMG" alt="" />

                    <p>{{ artipop.ARTICLE_CONTENT }}</p>

                    <!-- <div class="articlebtn">
                        <a href="" class="prarti">＜ 上一篇</a>
                        <a href="" class="nxarti">下一篇 ＞</a>
                    </div> -->
                </div>
            </div>
        </div>

        <my-footer></my-footer>

        <toTopBtn></toTopBtn>
    </div>
</template>

<script>
import myFooter from '@/components/myFooter';
import toTopBtn from '@/components/toTopBtn';
import axios from 'axios';

export default {
    components: {
        myFooter,
        toTopBtn,
    },
    data() {
        return {
            artipop: null,
            starinfo: [],
            starsignname: '',
            starsignbday1: '',
            starsignbday2: '',
            starsignpers: '',
            starsignpt: '',
            pers1: '',
            pers1val: '',
            pers2: '',
            pers2val: '',
            pers3: '',
            pers3val: '',
            starsigndaily: '',
            next: null,
            prev: null,
            starart: [],
            starprdt: [],
            sspdtitle: '',
            sspdimg: '',
            sspdid: '',
        };
    },
    methods: {
        onArtiPopOpen(arti) {
            //抓選到的arti
            this.artipop = arti;
        },
        onArtiPopClose() {
            this.artipop = null;
        },
    },
    mounted() {
        let urlParams = new URLSearchParams(window.location.search);

        if(document.documentElement.scrollTop >= 1000){
            document.documentElement.scrollTop = 0;
        }

        let id = urlParams.get('id');

        if (id) {
            id = id - 1;
        } else {
            id = 0;
        }

        //左右切換id
        this.next = id === 11 ? 1 : id + 2;
        this.prev = id === 0 ? 12 : id;

        axios
            // .post('http://localhost:8080/tfd101/project/g3/php/starsign.php')
            .post('php/starsign.php')
            .then((res) => {
                // console.log(res);
                this.starinfo = res.data;
                // console.log(this.starinfo);

                this.starsignname = this.starinfo[id].STAR_SIGN_NAME;
                this.starsignbday1 = this.starinfo[id].STAR_SIGN_S;
                this.starsignbday2 = this.starinfo[id].STAR_SIGN_E;
                this.starsignpers = this.starinfo[id].STAR_SIGN_PRF;
                this.starsignpt = this.starinfo[id].MONSTER_IMG;
                this.pers1 = this.starinfo[id].PERSONLITY_1;
                this.pers1val = this.starinfo[id].PERSONLITY_1_VALUE;
                this.pers2 = this.starinfo[id].PERSONLITY_2;
                this.pers2val = this.starinfo[id].PERSONLITY_2_VALUE;
                this.pers3 = this.starinfo[id].PERSONLITY_3;
                this.pers3val = this.starinfo[id].PERSONLITY_3_VALUE;
                this.starsigndaily = this.starinfo[id].DAILY;
                
            }),
        axios
            // .post('http://localhost:8080/tfd101/project/g3/php/article.php',
            .post('php/article.php', 
               { id: id + 1}, //傳給php
            )
            .then((res) => {
                console.log(res);
                this.starart = res.data;
                // console.log(this.starart);
                
            }),
        axios
            // .post('http://localhost:8080/tfd101/project/g3/php/luckyproduct.php')
            .post('php/luckyproduct.php')
            .then((res) => {
                console.log(res);
                this.starprdt = res.data;
                // console.log(this.starprdt);
                
                this.sspdtitle = this.starprdt[id].PRODUCT_NAME;
                this.sspdimg = this.starprdt[id].PRODUCT_IMG;
                this.sspdid = this.starprdt[id].PRODUCT_ID;
                
            });
    },
    filters: {
        //限制顯示字數
        ellipsis(value) {
            const len = 55;
            if (!value) return '';
            if (value.length > len) {
                return value.slice(0, len) + ' ...';
            }
            return value;
        },
    },
};
</script>

<style lang="scss">
@import '@/scss/mixins.scss';
@import '@/scss/rwd.scss';
@import '@/scss/color.scss';
@import '@/scss/var.scss';
@import '@/scss/pagination.scss';

.wrapper_starsign {
    background: linear-gradient(to right, #467b6b, #003352);
    width: 100%;
    letter-spacing: $ls;
    box-sizing: border-box;
    a {
        text-decoration: none;
    }
    .galaxys__top {
        background-color: rgb(53, 52, 67);
        padding-bottom: 20px;
    }
    .galaxys {
        position: relative;
        overflow: hidden;
        height: auto;
        .starsign_title {
            position: relative;
            margin: auto;
            color: $colorT;
            padding: (80px+240px) * 0.7 0 0;
            z-index: 15;
            @include rwd(mobile) {
                padding: (200px) * 0.7 0 0;
            }
            &-c {
                display: flex;
                justify-content: center;
                align-items: center;
                img {
                    width: 63px * 0.7;
                    height: 43px * 0.7;
                    margin-bottom: 5px;
                    @include rwd(mobile) {
                        width: 63px * 0.5;
                        height: 43px * 0.5;
                    }
                }
            }
            h1 {
                font-size: $h1;
                padding: 5px 20px 5px;
                @include rwd(mobile) {
                    font-size: $h1 - 8px;
                    padding: 5px 15px 5px;
                }
            }
            &-e {
                text-align: center;
                font-size: $p1;
                @include rwd(mobile) {
                    font-size: $p1 - 6px;
                }
            }
        }
        .starship {
            width: 100%;
            height: auto;
            position: relative !important;
            display: block !important;
            z-index: 10;
            pointer-events: none; //穿透
        }
        .galx1 {
            top: 15vw; //根據vw縮放
            width: 100vw * 1000 /1920;
            position: absolute;
            left: 16vw;
            z-index: 5;
            opacity: 0.9;
            img {
                width: 100%;
                height: auto;
            }
            &:hover {
                width: 100vw * 1020 /1920;
                opacity: 1;
            }
        }
        .galx2 {
            top: 11vw;
            width: 100vw * 800 /1920;
            position: absolute;
            right: -20vw;
            z-index: 6;
            opacity: 0.9;
            img {
                width: 100%;
                height: auto;
            }
            &:hover {
                width: 100vw * 820 /1920;
                opacity: 1;
            }
        }
        .galx3 {
            top: 3vw;
            width: 100vw * 500 /1920;
            position: absolute;
            left: 50vw;
            z-index: 6;
            opacity: 0.9;
            img {
                width: 100%;
                height: auto;
            }
            &:hover {
                width: 100vw * 520 /1920;
                opacity: 1;
            }
        }
        .galx4 {
            top: 4vw;
            width: 100vw * 600 /1920;
            position: absolute;
            left: -10vw;
            z-index: 6;
            opacity: 0.9;
            img {
                width: 100%;
                height: auto;
            }
            &:hover {
                width: 100vw * 620 /1920;
                opacity: 1;
            }
        }
    }
    .starsignsec {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 300;
        background-color: rgb(53, 52, 67);

        .starsignswitch {
            display: flex;
            justify-content: center;
            align-items: center;
            a {
                width: 45px;
                box-sizing: content-box;
                cursor: pointer;
                @include rwd(mobile) {
                    width: 5vw;
                }
                &:hover {
                    opacity: 0.7;
                }
                img {
                    width: 100%;
                }
            }
            .prbtn {
                margin-right: 30px;
                @include rwd(pad2) {
                    margin-right: 2vw;
                }
            }
            .nxbtn {
                margin-left: 30px;
                @include rwd(pad2) {
                    margin-left: 2vw;
                }
            }
            .drivingcard {
                background-color: rgb(230, 230, 230);
                width: 800px;
                height: 528px;
                border-radius: 10px;
                @include rwd(pad2) {
                    margin-top: 20px;
                    width: 75vw;
                    height: auto;
                }
                h2 {
                    font-size: $h2;
                    font-weight: 500;
                    color: rgb(82, 82, 121);
                    padding: 45px 0 30px;
                    text-align: center;
                    @include rwd(mobile) {
                        font-size: $h2 - 6px;
                        padding: 30px 0 25px;
                    }
                }
                .cardtop {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    @include rwd(pad2) {
                        align-items: flex-start;
                    }
                    .cardpt {
                        width: 180px;
                        @include rwd(pad2) {
                            width: 140px;
                        }
                        @include rwd(mobile) {
                            width: 20vw;
                        }
                    }
                    .cardct {
                        padding-left: 32px;
                        width: 60%;
                        color: #555;
                        @include rwd(mobile) {
                            padding-left: 3vw;
                        }
                        h3 {
                            font-size: $h3;
                            padding-bottom: 30px;
                            @include rwd(pad2) {
                                padding-bottom: 2vw;
                            }
                            @include rwd(mobile) {
                                font-size: 3vw;
                                padding-bottom: 2vw;
                            }
                        }
                        p {
                            font-size: $p1;
                            line-height: 1.2;
                            @include rwd(mobile) {
                                font-size: 3vw;
                            }
                        }
                    }
                }
                .cardbottom {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    .cdbtl {
                        font-size: $h3;
                        line-height: 1.2;
                        color: #aaa;
                        padding-right: 30px;
                        padding-left: 15px;
                        @include rwd(pad2) {
                            display: none;
                        }
                    }
                    .cdbtr {
                        display: flex;
                        margin-top: 24px;
                        @include rwd(pad2) {
                            margin-top: 17px;
                            margin-bottom: 28px;
                            justify-content: center;
                        }
                        .prs {
                            box-sizing: border-box;
                            background-size: 145px 138px;
                            width: 145px;
                            height: 138px;
                            padding-top: 40px;
                            padding-left: 9px;
                            @include rwd(mobile) {
                                background-size: 20vw 19vw;
                                width: 20vw;
                                height: 19vw;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                flex-direction: column;
                                padding-top: 0px;
                                padding-left: 7px;
                            }
                            h3 {
                                font-size: $h3;
                                line-height: 1.2;
                                text-align: center;
                                @include rwd(mobile) {
                                    font-size: 3.5vw;
                                    line-height: 1.1;
                                }
                            }
                        }
                        .prs1 {
                            background-image: url(/images/starsign/prs1.png);
                            margin-right: 1.5vw;
                            h3 {
                                color: #fa5078;
                            }
                        }
                        .prs2 {
                            background-image: url(/images/starsign/prs2.png);
                            margin-right: 1.5vw;
                            h3 {
                                color: #4078c4;
                            }
                        }
                        .prs3 {
                            background-image: url(/images/starsign/prs3.png);
                            h3 {
                                color: #29b196;
                            }
                        }
                    }
                }
            }
        }
        .starsigncont {
            display: flex;
            flex-direction: row;
            margin-top: 40px;
            @include rwd(pad2) {
                flex-direction: column;
                align-items: center;
                margin-top: 30px;
            }
            h2 {
                font-size: $h2;
                color: rgb(252, 140, 99);
                padding: 70px 0 35px;
                text-align: center;
                @include rwd(pad2) {
                    padding: 32px 0 25px;
                }
                @include rwd(mobile) {
                    font-size: $h2 - 6px;
                    padding: 32px 0 20px;
                }
            }
            .starsignleft {
                width: 530px;
                @include rwd(pad2) {
                    width: 75vw;
                }
                .luckyeveryday {
                    background-image: url(/images/starsign/lfbg.png);
                    background-size: 500px 520px;
                    width: 500px;
                    height: 520px;
                    @include rwd(pad2) {
                        background-image: none;
                        background-color: rgba(255, 255, 255, 0.1);
                        border: rgb(245, 245, 245) solid 3px;
                        width: 75vw;
                        height: auto;
                    }
                    p {
                        font-size: $h3 - 1px;
                        letter-spacing: 2px;
                        line-height: 1.7;
                        font-weight: 300;
                        width: 356px;
                        color: #fff;
                        margin: auto;
                        padding-left: 15px;
                        @include rwd(pad2) {
                            font-size: $h3 - 4px;
                            width: 85%;
                            padding-left: 0px;
                            margin-bottom: 30px;
                        }
                        @include rwd(mobile) {
                            font-size: $h3 - 8px;
                            width: 85%;
                            padding-left: 7px;
                            margin-bottom: 30px;
                        }
                    }
                }
                .productforyou {
                    background-image: url(/images/starsign/lfbg.png);
                    background-size: 500px 520px;
                    width: 500px;
                    height: 520px;
                    margin-top: 30px;
                    @include rwd(pad2) {
                        background-image: none;
                        background-color: rgba(255, 255, 255, 0.1);
                        border: rgb(245, 245, 245) solid 3px;
                        width: 75vw;
                        height: auto;
                        margin-bottom: 30px;
                    }
                    .sspd {
                        margin: auto;
                        img {
                            width: 280px;
                            height: 250px;
                            display: block;
                            margin: 0 auto;
                            border-radius: 10px;
                            @include rwd(pad2) {
                                width: 320px;
                                height: auto;
                            }
                            @include rwd(mobile) {
                                width: 60%;
                                height: auto;
                            }
                        }
                    }
                    h3 {
                        font-size: $h3 - 1px;
                        color: #fff;
                        text-align: center;
                        margin-top: 30px;
                        font-weight: 400;
                        @include rwd(pad2) {
                            font-size: $h3 - 4px;
                            margin-bottom: 30px;
                        }
                        @include rwd(mobile) {
                            font-size: $h3 - 7px;
                            margin-bottom: 30px;
                        }
                        &:hover{
                            opacity: .7;
                        }
                    }
                }
            }
            .starsignarticle {
                background-image: url(/images/starsign/rtbg.png);
                background-size: 550px 900px;
                width: 550px;
                height: 900px;
                @include rwd(pad2) {
                    background-image: none;
                    background-color: rgba(255, 255, 255, 0.1);
                    border: rgb(245, 245, 245) solid 3px;
                    width: 75vw;
                    height: auto;
                }
                .artiwrapper {
                    height: 690px;
                    overflow: auto;
                    @include rwd(pad2) {
                        height: 560px;
                    }
                    @include rwd(mobile) {
                        overflow: visible;
                        height: auto;
                    }
                    .artimenu {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        padding-left: 20px;
                        @include rwd(pad2) {
                                padding-left: 7px;
                        }
                        .artitem {
                            padding-left: 0px;
                            width: 430px;
                            color: #fff;
                            margin-bottom: 38px;
                            @include rwd(pad2) {
                                width: 85%;
                            }
                            .artitle {
                                font-size: $h3 - 1px;
                                line-height: 1.4;
                                text-decoration: none;
                                cursor: pointer;
                                color: #fff;
                                @include rwd(pad2) {
                                    font-size: $h3 - 3px;
                                }
                                @include rwd(mobile) {
                                    font-size: $h3 - 7px;
                                }
                                &:hover{
                                    opacity: .7;
                                }
                            }
                            .artminp {
                                font-size: $p2;
                                line-height: 1.6;
                                padding-top: 10px;
                                font-weight: 300;
                                @include rwd(mobile) {
                                    font-size: $p2 - 3px;
                                }
                            }
                            .armorebtn {
                                cursor: pointer;
                                font-size: $p2;
                                color: rgb(252, 140, 99);
                                display: block;
                                text-align: right;
                                padding-right: 15px;
                                padding-top: 10px;
                                @include rwd(pad2) {
                                    font-size: $p2 - 3px;
                                    padding-right: 15px;
                                }
                                &:hover{
                                    opacity: .5;
                                }
                            }
                        }
                    }
                }
                // .ssarti_pagination {
                //     @include pagination;
                //     a {
                //         color: white;
                //     }
                //     .-on {
                //         color: rgb(252, 140, 99);
                //     }
                //     @include rwd(pad2) {
                //         margin-bottom: 30px;
                //     }
                // }
            }
        }
    }
    //scrollbar
    ::-webkit-scrollbar {
        width: 3.5px;
    }
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.2);
    }
    ::-webkit-scrollbar-thumb {
        background: rgba(252, 140, 99, 0.8);
    }
    ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.8);
    }

    //article popup
    .overlayarticle {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(7, 7, 7, 0.6);
        // display: none;
        z-index: 1000;
        overflow: scroll;
        .artiflex {
            display: flex;
            justify-content: center;
            .articlepop {
                margin: 110px 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                background-color: #fff;
                border-radius: 15px;
                width: 65%;
                position: relative;
                z-index: 1000;
                @include rwd(pad2) {
                    width: 80%;
                }
                @include rwd(mobile) {
                    width: 90%;
                    margin: 60px 0;
                }
                .articlosebtn {
                    cursor: pointer;
                    position: absolute;
                    top: 3px;
                    right: 25px;
                    color: #aaa;
                    font-size: 55px;
                    font-weight: 200;
                    text-decoration: none;
                    &:hover {
                        opacity: 0.7;
                    }
                }
                h2 {
                    color: rgb(82, 82, 121);
                    font-size: $h3;
                    margin: 70px 12% 10px;
                    @include rwd(mobile) {
                        font-size: $h3 - 6px;
                        line-height: 1.5;
                        margin: 70px 10% 10px;
                    }
                }
                img {
                    width: 68%;
                    margin: 30px 0;
                    border-radius: 10px;
                    @include rwd(mobile) {
                        width: 65%;
                        margin: 20px 0;
                    }
                }
                p {
                    color: #777;
                    font-size: $p2;
                    margin: 10px 15% 60px;
                    letter-spacing: $ls;
                    line-height: 1.4;
                    @include rwd(mobile) {
                        font-size: $p2 - 3px;
                        margin: 10px 10% 60px;
                    }
                }
                // .articlebtn {
                //     margin: 40px 0 50px;
                //     display: flex;
                //     width: 70%;
                //     justify-content: space-between;
                //     align-items: center;
                //     @include rwd(mobile) {
                //         width: 80%;
                //     }
                //     a {
                //         color: rgb(82, 82, 121);
                //         font-size: $p2;
                //         @include rwd(mobile) {
                //             font-size: $p2 - 3px;
                //         }
                //     }
                // }
            }
        }
    }

    footer {
        background-color: rgb(53, 52, 67);
        margin-top: -10px;
    }
}
</style>
